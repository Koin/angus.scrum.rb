"use strict";var apiServer="api-scrum-rb.herokuapp.com";angular.module("angus.scrum.rbApp",["ngResource"]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"/views/products.html",controller:"ProductCtrl"}).when("/product/:productId/stories.html",{templateUrl:"/views/stories.html",controller:"StoryCtrl"}).when("/product/:productId/story/:storyId/tasks.html",{templateUrl:"/views/tasks.html",controller:"TaskCtrl"}).otherwise({redirectTo:"/"})}]).factory("Products",["$resource",function(t){return t("http://"+apiServer+"/products/:id",{id:"@id"},{get:{method:"GET"},query:{method:"GET",isArray:!0},save:{method:"PUT"},create:{method:"POST"},destroy:{method:"DELETE"}})}]).factory("Stories",["$resource",function(t){return t("http://"+apiServer+"/stories/:id",{id:"@id"},{query:{method:"GET",isArray:!0},save:{method:"PUT"},create:{method:"POST"},destroy:{method:"DELETE"}})}]).factory("Tasks",["$resource",function(t){return t("http://"+apiServer+"/tasks/:id",{id:"@id"},{query:{method:"GET",isArray:!0},save:{method:"PUT"},create:{method:"POST"},destroy:{method:"DELETE"}})}]),angular.module("angus.scrum.rbApp").directive("drag",["$rootScope",function(t){function r(t,r,e){r.addClass(e),t.dataTransfer.setData("id",t.target.id),t.dataTransfer.effectAllowed="move"}function e(t,r,e){r.removeClass(e)}return{restrict:"A",link:function(o,s,d){d.$set("draggable","true"),o.dragData=o[d.drag],o.dragStyle=d.dragStyle,s.bind("dragstart",function(e){t.draggedElement=o.dragData,r(e,s,o.dragStyle)}),s.bind("dragend",function(t){e(t,s,o.dragStyle)})}}}]).directive("drop",["$rootScope",function(t){function r(t,r,e){t.preventDefault(),r.addClass(e)}function e(t,r,e){r.removeClass(e)}function o(t){t.preventDefault()}function s(t,r,e){t.preventDefault(),r.removeClass(e)}return{restrict:"A",link:function(d,a,n){d.dropData=d[n.drop],d.dropStyle=n.dropStyle,a.bind("dragenter",function(t){r(t,a,d.dropStyle)}),a.bind("dragleave",function(t){e(t,a,d.dropStyle)}),a.bind("dragover",o),a.bind("drop",function(r){s(r,a,d.dropStyle),t.$broadcast("dropEvent",t.draggedElement,d.dropData)})}}}]),angular.module("angus.scrum.rbApp").controller("ProductCtrl",["$scope","$rootScope","Products",function(t,r,e){r.breadcrumbs=[{name:"Home",path:"/"}],t.products=e.query(),t.edit=function(r){t.product=r},t.save=function(){t.product.$save?t.product.$save():t.products.push(e.create(t.product))},t.delete=function(r,e,o){o.stopPropagation(),t.products.splice(e,1),r.$destroy()}}]),angular.module("angus.scrum.rbApp").controller("StoryCtrl",["$scope","$rootScope","$routeParams","Products","Stories",function(t,r,e,o,s){t.productId=e.productId,r.breadcrumbs=[{name:"Home",path:"/"}],t.product=o.get({id:t.productId},function(t){r.breadcrumbs.push({name:t.label})}),t.stories=s.query({product_id:t.productId}),t.edit=function(r){t.story=r},t.save=function(){t.story.product_id=t.productId,t.story.$save?t.story.$save():t.stories.push(s.create(t.story))},t.delete=function(r,e,o){o.stopPropagation(),t.stories.splice(e,1),r.$destroy()},r.$on("dropEvent",function(r,e,o){var s,d,a;for(s=0;t.stories.length>s;s++){var n=t.stories[s];e.id===n.id&&(d=s),o.id===n.id&&(a=s)}var u=t.stories[d];t.stories[d]=t.stories[a],t.stories[a]=u,t.stories[d].order=d,t.stories[d].$save(),t.stories[a].order=a,t.stories[a].$save()})}]),angular.module("angus.scrum.rbApp").controller("TaskCtrl",["$scope","$rootScope","$routeParams","Products","Stories","Tasks",function(t,r,e,o,s,d){t.productId=e.productId,t.storyId=e.storyId,r.breadcrumbs=[{name:"Home",path:"/"}],t.story=s.get({id:t.storyId},function(e){o.get({id:t.productId},function(t){r.breadcrumbs.push({name:t.label,path:"#/product/"+t.id+"/stories.html"}),r.breadcrumbs.push({name:e.label})}),console.log(e)}),t.tasks=d.query({story_id:t.storyId}),t.edit=function(r){t.task=r},t.save=function(){t.task.story_id=t.storyId,t.task.$save?t.task.$save():t.tasks.push(d.create(t.task))},t.delete=function(r,e,o){o.stopPropagation(),t.tasks.splice(e,1),r.$destroy()},r.$on("dropEvent",function(r,e,o){var s,d,a;for(s=0;t.tasks.length>s;s++){var n=t.tasks[s];e.id===n.id&&(d=s),o.id===n.id&&(a=s)}var u=t.tasks[d];t.tasks[d]=t.tasks[a],t.tasks[a]=u,t.tasks[d].order=d,t.tasks[d].$save(),t.tasks[a].order=a,t.tasks[a].$save()})}]);